<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8"/>
  <title>Admin Panel ‚Äì O‚Äòzbek Taomlari</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root{
      --p:#ff6b00;--bg:#f6f8fa;--card:#fff;--red:#e53e3e;--green:#38a169;--blue:#3182ce;
      --shadow:0 8px 32px rgba(0,0,0,.06);--curve:16px;--font:Inter,system-ui;
    }
    *{box-sizing:border-box;margin:0;padding:0;font-family:var(--font)}
    body{background:var(--bg);color:#111;padding-bottom:60px}
    header{position:sticky;top:0;background:#fff;backdrop-filter:blur(20px);padding:12px 16px;display:flex;gap:10px;flex-wrap:wrap;align-items:center;box-shadow:var(--shadow);z-index:10}
    input,select{padding:8px 12px;border:1px solid #ccc;border-radius:var(--curve);font-size:14px}
    button{padding:8px 14px;border:none;border-radius:var(--curve);background:var(--p);color:#fff;font-size:14px;font-weight:600;cursor:pointer;transition:.2s}
    button:active{transform:scale(.95)}
    .board{padding:16px;display:grid;gap:12px;grid-template-columns:repeat(auto-fill,minmax(300px,1fr))}
    .order{background:#fff;border-radius:var(--curve);box-shadow:var(--shadow);padding:14px;display:flex;flex-direction:column;gap:8px}
    .order.new{border-left:6px solid var(--p)}
    .order.tayyor{border-left-color:var(--blue)}
    .order.yetkazildi{border-left-color:var(--green)}
    .order.bekor{border-left-color:var(--red)}
    .top-row{display:flex;justify-content:space-between;align-items:center}
    .items{font-size:14px;color:#444}
    .addr{font-size:14px;font-weight:600}
    .sum{color:var(--p);font-weight:700;font-size:16px}
    .acts{display:flex;gap:6px;margin-top:8px;flex-wrap:wrap}
    .login{display:flex;flex-direction:column;gap:12px;align-items:center;margin-top:30vh;padding:0 20px;text-align:center}
    .login img{width:80px;border-radius:50%;margin-bottom:12px}
    .empty{padding:40px;text-align:center;opacity:.5}
    @media(max-width:400px){.board{grid-template-columns:1fr}}
  </style>
</head>
<body>

<div id="login" class="login">
  <img src="https://i.ibb.co/20mqx4f8/metbex1-8.jpg" alt="logo">
  <h2>Admin Panelga Kirish</h2>
  <p>Bot orqali kirish uchun <b>/login</b> buyrug‚Äòini yuboring.</p>
  <button onclick="checkAdmin()">Tekshirish</button>
</div>

<header id="toolbar" style="display:none">
  <input id="phoneFilter" placeholder="Telefon orqali qidiruv">
  <select id="statusFilter">
    <option value="">Barcha holatlar</option>
    <option value="yangi">Yangi</option>
    <option value="tayyor">Tayyor</option>
    <option value="yo'lda">Yo‚Äòlda</option>
    <option value="yetkazildi">Yetkazildi</option>
    <option value="bekor">Bekor</option>
  </select>
  <button onclick="loadOrders()">üîç</button>
  <button onclick="location.reload()">üîÑ</button>
</header>

<div id="board" class="board"></div>

<script>
  const ADMIN_IDS = [7961099561]; // ‚Üê o‚Äòzingizniki
  const API = 'https://asliddinx278-ops.github.io/uzfood/admin-data.json'; // keyinroq dynamic qilamiz

  function checkAdmin() {
    const uid = new URLSearchParams(location.search).get('uid');
    if (!uid) {
      alert("‚ùå UID topilmadi. Bot orqali kirish uchun /login ni yuboring.");
      return;
    }
    if (ADMIN_IDS.includes(parseInt(uid))) {
      document.getElementById('login').style.display = 'none';
      document.getElementById('toolbar').style.display = 'flex';
      loadOrders();
      setInterval(loadOrders, 10000);
    } else {
      alert("‚ùå Siz admin emassiz.");
    }
  }

  async function loadOrders() {
    const phone = document.getElementById('phoneFilter').value;
    const status = document.getElementById('statusFilter').value;
    const q = new URLSearchParams({phone, status}).toString();
    const res = await fetch(API + '?' + q);
    const data = await res.json();
    render(data.orders || []);
  }

  function render(orders) {
    const b = document.getElementById('board');
    if (!orders.length) { b.innerHTML = '<p class="empty">Buyurtmalar yo‚Äòq.</p>'; return; }
    b.innerHTML = orders.map(o => `
      <div class="order ${o.status==='yangi'?'new': o.status==='tayyor'?'tayyor': o.status==='yetkazildi'?'yetkazildi': o.status==='bekor'?'bekor':''}">
        <div class="top-row">
          <span><b>#${o.id.slice(-6)}</b></span>
          <span class="sum">${o.total.toLocaleString()} so‚Äòm</span>
        </div>
        <div class="items">${o.items.map(it=>`${it.name} x${it.q}`).join(', ')}</div>
        <div class="addr">üìç <a href="https://www.google.com/maps?q=${o.lat},${o.lon}" target="_blank">Xaritada ko‚Äòrish</a></div>
        <div>üìû ${o.phone} | ‚è± ${new Date(o.created).toLocaleString('uz-UZ')}</div>
        <div class="acts">
          <button onclick="setStatus('${o.id}','tayyor')">Tayyor</button>
          <button onclick="setStatus('${o.id}','yo\'lda')">Yo‚Äòlda</button>
          <button onclick="setStatus('${o.id}','yetkazildi')">Yetkazildi</button>
          <button onclick="setStatus('${o.id}','bekor')" style="background:#e53e3e">Bekor</button>
        </div>
      </div>`).join('');
  }

  async function setStatus(id, st) {
    await fetch(API + '/orders/' + id, {
      method: 'PATCH',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({status: st})
    });
    loadOrders();
  }

  // avtomatik tekshirish
  checkAdmin();
</script>
</body>
</html>
